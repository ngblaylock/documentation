<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Storage | Nathan&#39;s Docs</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/assets/css/0.styles.5fd868be.css" as="style"><link rel="preload" href="/assets/js/app.2e9ee754.js" as="script"><link rel="preload" href="/assets/js/2.591a3c31.js" as="script"><link rel="preload" href="/assets/js/13.8405a570.js" as="script"><link rel="prefetch" href="/assets/js/10.0f48757a.js"><link rel="prefetch" href="/assets/js/11.53e076de.js"><link rel="prefetch" href="/assets/js/12.1b4d4ec9.js"><link rel="prefetch" href="/assets/js/14.017b5623.js"><link rel="prefetch" href="/assets/js/15.6c23b5b1.js"><link rel="prefetch" href="/assets/js/16.a15955a0.js"><link rel="prefetch" href="/assets/js/17.3e6b1616.js"><link rel="prefetch" href="/assets/js/18.8426a441.js"><link rel="prefetch" href="/assets/js/19.61717e76.js"><link rel="prefetch" href="/assets/js/20.a61f1ecb.js"><link rel="prefetch" href="/assets/js/21.a783e6fa.js"><link rel="prefetch" href="/assets/js/22.d5dc2688.js"><link rel="prefetch" href="/assets/js/23.e8f558e2.js"><link rel="prefetch" href="/assets/js/24.6a83f850.js"><link rel="prefetch" href="/assets/js/25.6f7a6fe9.js"><link rel="prefetch" href="/assets/js/26.b1ac5462.js"><link rel="prefetch" href="/assets/js/3.48d34bfc.js"><link rel="prefetch" href="/assets/js/4.65be5248.js"><link rel="prefetch" href="/assets/js/5.772ab4eb.js"><link rel="prefetch" href="/assets/js/6.f2b85beb.js"><link rel="prefetch" href="/assets/js/7.223d26a8.js"><link rel="prefetch" href="/assets/js/8.a90639e0.js"><link rel="prefetch" href="/assets/js/9.082bb87e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5fd868be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Nathan's Docs</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue.js</a></div><div class="nav-item"><a href="/firebase/" class="nav-link router-link-active">Firebase</a></div><div class="nav-item"><a href="/other/" class="nav-link">Other</a></div><div class="nav-item"><a href="https://www.nathanblaylock.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/vue/" class="nav-link">Vue.js</a></div><div class="nav-item"><a href="/firebase/" class="nav-link router-link-active">Firebase</a></div><div class="nav-item"><a href="/other/" class="nav-link">Other</a></div><div class="nav-item"><a href="https://www.nathanblaylock.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Portfolio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue.js</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Firebase</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/firebase/" class="sidebar-link">Firebase</a></li><li><a href="/firebase/hosting.html" class="sidebar-link">Hosting</a></li><li><a href="/firebase/authentication.html" class="sidebar-link">Authentication</a></li><li><a href="/firebase/firestore.html" class="sidebar-link">Firestore</a></li><li><a href="/firebase/storage.html" class="active sidebar-link">Storage</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/firebase/storage.html#upload-a-file" class="sidebar-link">Upload a file</a></li><li class="sidebar-sub-header"><a href="/firebase/storage.html#download-a-file-url" class="sidebar-link">Download a File URL</a></li><li class="sidebar-sub-header"><a href="/firebase/storage.html#deleting-a-file" class="sidebar-link">Deleting a File</a></li><li class="sidebar-sub-header"><a href="/firebase/storage.html#list-files" class="sidebar-link">List Files</a></li></ul></li><li><a href="/firebase/securityrules.html" class="sidebar-link">Security Rules</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Other</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="storage"><a href="#storage" class="header-anchor">#</a> Storage</h1> <h2 id="upload-a-file"><a href="#upload-a-file" class="header-anchor">#</a> Upload a file</h2> <p>First thing first, you need to create a form that has a <code>&lt;input type=&quot;file&quot;&gt;</code> input. Instead of working with the file when the form is submitted, you may need to watch for a change on the input. The following is an example using Vue.js to store the uploaded file in <code>this.fileToUpload</code>. The HTML element should be <code>&lt;input type=&quot;file&quot; @change=&quot;processFile&quot;&gt;</code>. If you are using basic javascript, it should be essentially the same code, but will require adding an event listener to get the file upload change and/or form submit.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">processFile</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>fileToUpload <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><p>Once you have the reference to the file uploaded, you can run the following either directly after the change event, or on submitting the form</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// In Firebase, the document will be named `upload.jpg`, but this can be customized to be whatever you want.</span>
<span class="token comment">// Todo: get the file to be uploaded and change out the &lt;fileToUpload&gt;</span>
<span class="token keyword">let</span> uploadTask <span class="token operator">=</span> firebase
  <span class="token punctuation">.</span><span class="token function">storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">images/upload.jpg</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fileToUpload<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Use to return a progress indicator, and to return a URL for the uploaded image</span>
uploadTask<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span>
  <span class="token string">&quot;state_changed&quot;</span><span class="token punctuation">,</span>
  <span class="token parameter">snapshot</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> progress <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>
      <span class="token punctuation">(</span>snapshot<span class="token punctuation">.</span>bytesTransferred <span class="token operator">/</span> snapshot<span class="token punctuation">.</span>totalBytes<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Do something with the progress variable</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">There was an error uploading the file: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something after the file has been uploaded</span>
    <span class="token comment">// This would be a good place to download a file URL and store it somewhere</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="custom-block warning"><p class="custom-block-title">WARNING</p> <p>If you upload a file to the same file path using the same name, the new image will replace the old image. It may be wise to consider checking if that file path already exists before sending the file to the storage bucket and asking the user if they want to replace the image. The action can not be undone.</p></div> <p>It is best to store the upload reference AND the upload URL in firestore. That way, you can easily refer to it for reading, updating, and deleting.</p> <h2 id="download-a-file-url"><a href="#download-a-file-url" class="header-anchor">#</a> Download a File URL</h2> <div class="language-js extra-class"><pre class="language-js"><code>firebase
  <span class="token punctuation">.</span><span class="token function">storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;images/upload.jpg&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">getDownloadURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">url</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something with the url variable</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error getting document: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="deleting-a-file"><a href="#deleting-a-file" class="header-anchor">#</a> Deleting a File</h2> <div class="language-js extra-class"><pre class="language-js"><code>firebase
  <span class="token punctuation">.</span><span class="token function">storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;images/upload.jpg&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// Do something after the file has been deleted</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">The file didn't delete properly: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="list-files"><a href="#list-files" class="header-anchor">#</a> List Files</h2> <p>You can list all the files and folders and it will return a reference to the file.</p> <div class="language-js extra-class"><pre class="language-js"><code>firebase
  <span class="token punctuation">.</span><span class="token function">storage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;images&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">listAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">res</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span>prefixes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">folderRef</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Folder Ref: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>folderRef<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    res<span class="token punctuation">.</span>items<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">itemRef</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Item Ref: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>itemRef<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error getting the list: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The reference is returned something like <code>gs://bucket/images/upload.jpg</code>. You can use this as a reference similar to using just <code>images/upload.jpg</code>. For example, <code>firebase.storage().refFromURL('gs://bucket/images/upload.jpg')</code></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2/22/2020, 7:18:43 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/firebase/firestore.html" class="prev">Firestore</a></span> <span class="next"><a href="/firebase/securityrules.html">Security Rules</a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.2e9ee754.js" defer></script><script src="/assets/js/2.591a3c31.js" defer></script><script src="/assets/js/13.8405a570.js" defer></script>
  </body>
</html>
